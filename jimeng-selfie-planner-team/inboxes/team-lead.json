[
  {
    "from": "reference-image-designer",
    "text": "# 用户自定义角色形象 - 参考图系统设计文档\n\n## 一、系统概述\n\n### 1.1 目标\n为用户提供两种方式创建自定义角色形象：\n1. **上传参考图**：用户上传自己的图片作为角色参考\n2. **AI生成三视图**：用户提供文字描述，系统自动生成角色的正/侧/背面三视图\n\n### 1.2 核心能力\n- 多格式图片上传与存储\n- 渐进式三视图生成（正面→侧面→背面）\n- 多参考图融合保持一致性\n- 多角色档案管理\n\n---\n\n## 二、参考图上传机制\n\n### 2.1 支持的图片格式\n\n| 格式 | 扩展名 | 推荐用途 | 最大尺寸 |\n|------|--------|----------|----------|\n| WebP | .webp | 首选格式，压缩率高 | 4096x4096 |\n| PNG | .png | 透明背景图片 | 4096x4096 |\n| JPEG | .jpg/.jpeg | 照片类图片 | 4096x4096 |\n\n### 2.2 存储位置结构\n\n```\n/home/xixil/.claude/skills/jimeng-character-assets/\n├── characters/                    # 角色档案目录\n│   ├── 西娅/\n│   │   ├── profile.json           # 角色配置\n│   │   ├── references/            # 参考图目录\n│   │   │   ├── user_upload/       # 用户上传的参考图\n│   │   │   │   ├── ref_001_20260213.webp\n│   │   │   │   └── ref_002_20260213.webp\n│   │   │   ├── generated/         # AI生成的参考图\n│   │   │   │   ├── front_20260213.webp\n│   │   │   │   ├── side_20260213.webp\n│   │   │   │   └── back_20260213.webp\n│   │   │   └── composite/         # 拼接图（用于预览）\n│   │   │       └── three_view_20260213.webp\n│   │   └── outputs/               # 生成输出目录\n│   │       ├── scene_cafe_001.webp\n│   │       └── scene_office_001.webp\n│   └── [其他角色名]/\n│       └── ...\n├── templates/                     # 模板目录\n│   ├── prompt_templates.json      # 提示词模板\n│   └── scene_templates.json       # 场景模板\n└── SKILL.md                       # Skill说明文档\n```\n\n### 2.3 文件命名规范\n\n```\n参考图命名格式：\n[类型]_[日期]_[序号].[扩展名]\n\n示例：\n- ref_20260213_001.webp     # 用户上传参考图\n- front_20260213_001.webp   # 生成的正面图\n- side_20260213_001.webp    # 生成的侧面图\n- back_20260213_001.webp    # 生成的背面图\n- scene_cafe_20260213_001.webp  # 场景生成图\n```\n\n---\n\n## 三、三视图生成流程\n\n### 3.1 流程图\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│  用户输入角色描述                                            │\n│  示例：\"25岁亚洲女性，鹅蛋脸，杏眼，长发，身高168cm\"          │\n└─────────────────────────────────────────────────────────────┘\n                            ↓\n┌─────────────────────────────────────────────────────────────┐\n│  Step 1: 生成正面图                                          │\n│  - 使用三视图正面模板                                        │\n│  - 纯白背景，素体服装                                        │\n│  - 输出4张候选图                                            │\n└─────────────────────────────────────────────────────────────┘\n                            ↓\n┌─────────────────────────────────────────────────────────────┐\n│  Step 2: 用户选择满意的正面图                                │\n│  - 展示4张候选图                                            │\n│  - 用户选择1张作为基准                                       │\n│  - 保存为: front_selected_[date].webp                       │\n└─────────────────────────────────────────────────────────────┘\n                            ↓\n┌─────────────────────────────────────────────────────────────┐\n│  Step 3: 生成侧面图                                          │\n│  - 上传选中的正面图作为参考图                                │\n│  - 使用三视图侧面模板                                        │\n│  - 强调90度正侧面，只能看到一只眼睛                          │\n│  - 输出4张候选图                                            │\n└─────────────────────────────────────────────────────────────┘\n                            ↓\n┌─────────────────────────────────────────────────────────────┐\n│  Step 4: 用户选择满意的侧面图                                │\n│  - 保存为: side_selected_[date].webp                        │\n└─────────────────────────────────────────────────────────────┘\n                            ↓\n┌─────────────────────────────────────────────────────────────┐\n│  Step 5: 生成背面图                                          │\n│  - 同时上传正面图+侧面图作为参考图（多参考图技术）            │\n│  - 使用三视图背面模板                                        │\n│  - 输出4张候选图                                            │\n└─────────────────────────────────────────────────────────────┘\n                            ↓\n┌─────────────────────────────────────────────────────────────┐\n│  Step 6: 完成角色基准图                                      │\n│  - 保存三张选中的图                                          │\n│  - 生成三视图拼接预览图                                      │\n│  - 更新角色档案                                              │\n└─────────────────────────────────────────────────────────────┘\n```\n\n### 3.2 三视图提示词模板\n\n```python\n# 正面图模板\nFRONT_VIEW_PROMPT = \"\"\"\n【角色设定】\n{user_description}\n\n【姿态要求】\n正面站立，双手自然垂于身体两侧，双脚并拢，完全正面对着镜头，身体不偏不倚\n\n【服装要求】\n白色短款紧身运动背心（露出腰部），黑色五分紧身裤，赤脚站立\n\n【技术要求】\n全身可见，从头到脚完整，比例准确，锐利清晰无变形，适合3D建模参考\n\n【背景】\n纯白色背景，无杂物\n\n【画质】\n8K超高清，照片级真实感，专业摄影棚光线，均匀照明\n\"\"\"\n\n# 侧面图模板\nSIDE_VIEW_PROMPT = \"\"\"\n【角色设定】\n{user_description}\n\n【姿态要求】\n标准90度正侧面，身体完全侧对镜头，只能看到一只眼睛，看不到另一只眼睛，可以看到半个后脑勺，双手自然下垂\n\n【服装要求】\n白色短款紧身运动背心（露出腰部），黑色五分紧身裤，赤脚站立\n\n【技术要求】\n全身可见，标准90度正侧面，只能看到一只眼睛，适合3D建模参考\n\n【背景】\n纯白色背景，无杂物\n\n【画质】\n8K超高清，照片级真实感，专业摄影棚光线，均匀照明\n\"\"\"\n\n# 背面图模板\nBACK_VIEW_PROMPT = \"\"\"\n【角色设定】\n{user_description}\n\n【姿态要求】\n完全背对镜头站立，双手自然垂于身体两侧，头部自然正对前方\n\n【服装要求】\n白色短款紧身运动背心（露出腰部），黑色五分紧身裤，赤脚站立\n\n【技术要求】\n全身可见，背面轮廓清晰，适合3D建模参考\n\n【背景】\n纯白色背景，无杂物\n\n【画质】\n8K超高清，照片级真实感，专业摄影棚光线，均匀照明\n\"\"\"\n```\n\n### 3.3 多参考图上传代码示例\n\n```python\ndef generate_side_view(front_image_path: str, user_description: str):\n    \"\"\"使用正面图作为参考生成侧面图\"\"\"\n    \n    # 构建提示词\n    prompt = SIDE_VIEW_PROMPT.format(user_description=user_description)\n    \n    # 上传正面图作为参考\n    reference_paths = [front_image_path]\n    \n    # 调用即梦生成\n    result = generate_with_reference(\n        prompt=prompt,\n        reference_paths=reference_paths,\n        save_dir=f\"/home/xixil/.claude/skills/jimeng-character-assets/characters/{character_name}/references/generated/\"\n    )\n    \n    return result\n\ndef generate_back_view(front_image_path: str, side_image_path: str, user_description: str):\n    \"\"\"使用正面图+侧面图作为参考生成背面图（多参考图技术）\"\"\"\n    \n    # 构建提示词\n    prompt = BACK_VIEW_PROMPT.format(user_description=user_description)\n    \n    # 上传多张参考图保持一致性\n    reference_paths = [front_image_path, side_image_path]\n    \n    # 调用即梦生成\n    result = generate_with_reference(\n        prompt=prompt,\n        reference_paths=reference_paths,\n        save_dir=f\"/home/xixil/.claude/skills/jimeng-character-assets/characters/{character_name}/references/generated/\"\n    )\n    \n    return result\n```\n\n---\n\n## 四、一致性保持机制\n\n### 4.1 多参考图上传（核心）\n\n```python\ndef upload_multiple_references(driver, reference_paths: list):\n    \"\"\"\n    上传多张参考图到即梦\n    \n    参数:\n        driver: Selenium WebDriver\n        reference_paths: 参考图路径列表\n    \"\"\"\n    file_input = driver.find_element(By.XPATH, \"//input[@type='file']\")\n    \n    for ref_path in reference_paths:\n        abs_path = os.path.abspath(ref_path)\n        file_input.send_keys(abs_path)\n        time.sleep(2)  # 每次上传后等待2秒\n    \n    # 验证上传数量\n    ref_imgs = driver.find_elements(By.XPATH, \"//img[contains(@src, 'blob')]\")\n    print(f\"已上传 {len(ref_imgs)} 张参考图\")\n    \n    return len(ref_imgs)\n```\n\n### 4.2 参考图权重设置\n\n```python\n# 参考图权重配置\nREFERENCE_WEIGHTS = {\n    \"front_view\": 0.5,      # 正面图权重最高\n    \"side_view\": 0.3,       # 侧面图次之\n    \"back_view\": 0.2,       # 背面图最低\n    \"user_upload\": 0.4      # 用户上传图权重\n}\n\ndef select_references_for_scene(scene_type: str, character_name: str) -> list:\n    \"\"\"\n    根据场景类型选择最佳参考图组合\n    \n    参数:\n        scene_type: 场景类型（如cafe, office等）\n        character_name: 角色名\n    \n    返回:\n        参考图路径列表（按优先级排序）\n    \"\"\"\n    base_dir = f\"/home/xixil/.claude/skills/jimeng-character-assets/characters/{character_name}/references\"\n    \n    references = []\n    \n    # 优先使用正面图\n    front_path = f\"{base_dir}/generated/front_selected_*.webp\"\n    if glob.glob(front_path):\n        references.append(glob.glob(front_path)[0])\n    \n    # 其次使用侧面图\n    side_path = f\"{base_dir}/generated/side_selected_*.webp\"\n    if glob.glob(side_path):\n        references.append(glob.glob(side_path)[0])\n    \n    # 最多上传3张参考图（即梦限制）\n    return references[:3]\n```\n\n### 4.3 自动加载参考图\n\n```python\ndef generate_scene_with_character(\n    character_name: str,\n    scene_type: str,\n    additional_prompt: str = \"\"\n):\n    \"\"\"\n    生成角色场景图（自动加载参考图）\n    \n    参数:\n        character_name: 角色名\n        scene_type: 场景类型\n        additional_prompt: 额外提示词\n    \"\"\"\n    # 1. 加载角色配置\n    profile = load_character_profile(character_name)\n    \n    # 2. 自动选择参考图\n    reference_paths = select_references_for_scene(scene_type, character_name)\n    \n    # 3. 构建提示词\n    prompt = build_scene_prompt(\n        appearance=profile[\"appearance\"],\n        scene=SCENE_TEMPLATES[scene_type],\n        additional=additional_prompt\n    )\n    \n    # 4. 生成图片\n    result = generate_with_reference(\n        prompt=prompt,\n        reference_paths=reference_paths,\n        save_dir=f\"/home/xixil/.claude/skills/jimeng-character-assets/characters/{character_name}/outputs/\"\n    )\n    \n    return result\n```\n\n---\n\n## 五、角色档案管理\n\n### 5.1 角色档案格式 (profile.json)\n\n```json\n{\n  \"name\": \"西娅\",\n  \"name_en\": \"Thea\",\n  \"created_at\": \"2026-02-13\",\n  \"updated_at\": \"2026-02-13\",\n  \n  \"basic_info\": {\n    \"age\": 25,\n    \"height\": \"168cm\",\n    \"gender\": \"female\",\n    \"ethnicity\": \"asian\"\n  },\n  \n  \"appearance\": {\n    \"face_shape\": \"鹅蛋脸\",\n    \"eyes\": \"杏眼，双眼皮，深棕色瞳孔\",\n    \"nose\": \"直鼻，鼻梁挺直\",\n    \"lips\": \"标准唇，自然红润\",\n    \"hair\": \"及肩黑色长发\",\n    \"skin\": \"白皙肤色，脸上无痣\",\n    \"body_marks\": [\n      \"右上臂外侧有3-4个小雀斑\",\n      \"右膝盖有轻微疤痕\"\n    ]\n  },\n  \n  \"references\": {\n    \"front_view\": \"generated/front_selected_20260213.webp\",\n    \"side_view\": \"generated/side_selected_20260213.webp\",\n    \"back_view\": \"generated/back_selected_20260213.webp\",\n    \"user_uploads\": [\n      \"user_upload/ref_001_20260213.webp\"\n    ]\n  },\n  \n  \"style\": {\n    \"work\": [\"职业简约\", \"黑/白/灰/藏蓝\"],\n    \"casual\": [\"精致休闲\", \"米色/卡其色/白色\"],\n    \"home\": [\"舒适慵懒\", \"丝绸睡衣/针织开衫\"]\n  },\n  \n  \"generated_count\": 0,\n  \"favorite_scenes\": [\"cafe_alone\", \"office_desk\", \"street_walking\"]\n}\n```\n\n### 5.2 多角色支持\n\n```python\n# 角色管理类\nclass CharacterManager:\n    def __init__(self, base_dir: str):\n        self.base_dir = base_dir\n        self.characters_dir = f\"{base_dir}/characters\"\n    \n    def list_characters(self) -> list:\n        \"\"\"列出所有角色\"\"\"\n        characters = []\n        for char_dir in os.listdir(self.characters_dir):\n            profile_path = f\"{self.characters_dir}/{char_dir}/profile.json\"\n            if os.path.exists(profile_path):\n                with open(profile_path, 'r', encoding='utf-8') as f:\n                    profile = json.load(f)\n                    characters.append({\n                        \"name\": profile[\"name\"],\n                        \"created_at\": profile[\"created_at\"],\n                        \"has_references\": bool(profile.get(\"references\", {}).get(\"front_view\"))\n                    })\n        return characters\n    \n    def create_character(self, name: str, description: str) -> str:\n        \"\"\"创建新角色\"\"\"\n        char_dir = f\"{self.characters_dir}/{name}\"\n        os.makedirs(f\"{char_dir}/references/user_upload\", exist_ok=True)\n        os.makedirs(f\"{char_dir}/references/generated\", exist_ok=True)\n        os.makedirs(f\"{char_dir}/outputs\", exist_ok=True)\n        \n        # 创建初始档案\n        profile = {\n            \"name\": name,\n            \"created_at\": datetime.now().strftime(\"%Y-%m-%d\"),\n            \"description\": description,\n            \"references\": {}\n        }\n        \n        with open(f\"{char_dir}/profile.json\", 'w', encoding='utf-8') as f:\n            json.dump(profile, f, ensure_ascii=False, indent=2)\n        \n        return char_dir\n    \n    def get_character(self, name: str) -> dict:\n        \"\"\"获取角色档案\"\"\"\n        profile_path = f\"{self.characters_dir}/{name}/profile.json\"\n        if os.path.exists(profile_path):\n            with open(profile_path, 'r', encoding='utf-8') as f:\n                return json.load(f)\n        return None\n```\n\n### 5.3 角色切换机制\n\n```python\n# 当前活跃角色\nCURRENT_CHARACTER = None\n\ndef switch_character(character_name: str):\n    \"\"\"切换当前活跃角色\"\"\"\n    global CURRENT_CHARACTER\n    \n    manager = CharacterManager(BASE_DIR)\n    profile = manager.get_character(character_name)\n    \n    if profile:\n        CURRENT_CHARACTER = profile\n        print(f\"已切换到角色: {character_name}\")\n        return True\n    else:\n        print(f\"未找到角色: {character_name}\")\n        return False\n\ndef get_current_character() -> dict:\n    \"\"\"获取当前活跃角色\"\"\"\n    return CURRENT_CHARACTER\n```\n\n---\n\n## 六、完整使用流程\n\n### 6.1 方式一：上传参考图\n\n```python\n# 1. 创建角色\nmanager = CharacterManager(BASE_DIR)\nmanager.create_character(\"我的角色\", \"用户自定义角色\")\n\n# 2. 上传参考图\nupload_reference_image(\n    character_name=\"我的角色\",\n    image_path=\"/path/to/user_photo.jpg\"\n)\n\n# 3. 生成场景图\ngenerate_scene_with_character(\n    character_name=\"我的角色\",\n    scene_type=\"cafe_alone\"\n)\n```\n\n### 6.2 方式二：AI生成三视图\n\n```python\n# 1. 创建角色并描述\nmanager = CharacterManager(BASE_DIR)\nmanager.create_character(\"新角色\", \"25岁亚洲女性，鹅蛋脸，长发\")\n\n# 2. 生成三视图\ngenerate_three_views(\n    character_name=\"新角色\",\n    description=\"25岁亚洲女性，鹅蛋脸，杏眼双眼皮，深棕色瞳孔，及肩黑色长发，白皙肤色，身高168cm，身材纤细匀称\"\n)\n\n# 3. 三视图生成完成后，可生成场景图\ngenerate_scene_with_character(\n    character_name=\"新角色\",\n    scene_type=\"office_desk\"\n)\n```\n\n---\n\n## 七、技术要点\n\n### 7.1 提示词注意事项\n\n1. **单行格式**：提示词不能有换行符，否则会触发立即生成\n2. **参考图等待**：上传参考图后需要等待2-3秒\n3. **多参考图验证**：上传后检查blob图片数量确认成功\n\n### 7.2 真实感增强\n\n```python\nREALISM_ENHANCERS = \"\"\"\n锐利清晰的对焦，边缘清晰锐利，无虚化无朦胧感，\n真实的皮肤纹理，可见的毛孔，轻微肤色不均，\n自然日光或室内灯光，有明暗过渡和阴影\n\"\"\"\n```\n\n### 7.3 自拍风格（场景图专用）\n\n三视图使用专业摄影风格，场景图使用自拍风格：\n\n```python\nSELFIE_STYLE = \"\"\"\n自拍视角，手持手机，镜面自拍，\n生活化的表情和姿态，不刻意摆拍\n\"\"\"\n```\n\n---\n\n## 八、与现有资源整合\n\n### 8.1 复用 jimeng-image-generator SKILL\n\n- 三视图提示词模板\n- 场景模板（26种场景）\n- 真实感增强词\n- 自拍风格模板\n\n### 8.2 复用角色档案\n\n- `/home/xixil/图片/角色档案_西娅.md` 格式\n- 26种场景定义\n- 外貌特征详细描述\n\n### 8.3 新增功能\n\n- 多角色管理系统\n- 参考图上传与存储\n- 渐进式三视图生成\n- 参考图自动选择\n\n---\n\n以上就是完整的用户自定义角色形象参考图系统设计文档。核心创新点是利用即梦的**多参考图上传功能**，实现渐进式三视图生成（正面→侧面→背面），以及后续场景生成时自动加载最佳参考图组合。",
    "summary": "自定义角色参考图系统设计文档",
    "timestamp": "2026-02-13T15:46:09.478Z",
    "color": "orange",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "{\"type\":\"idle_notification\",\"from\":\"clawra-analyst\",\"timestamp\":\"2026-02-13T15:47:01.057Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:47:01.057Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "reference-image-designer",
    "text": "{\"type\":\"idle_notification\",\"from\":\"reference-image-designer\",\"timestamp\":\"2026-02-13T15:47:15.388Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:47:15.388Z",
    "color": "orange",
    "read": true
  },
  {
    "from": "reference-image-designer",
    "text": "收到确认！参考图系统设计文档已完成。\n\n核心设计要点：\n- 渐进式三视图生成（利用多参考图上传技术）\n- 角色档案JSON格式管理\n- 自动参考图选择机制\n\n等待其他Agent（API研究、自拍策略、CLI设计、Clawra分析）完成后，可以开始整合方案。\n\n如果有任何需要调整或补充的地方，请随时告诉我。",
    "summary": "收到确认，等待整合",
    "timestamp": "2026-02-13T15:47:25.562Z",
    "color": "orange",
    "read": true
  },
  {
    "from": "reference-image-designer",
    "text": "{\"type\":\"idle_notification\",\"from\":\"reference-image-designer\",\"timestamp\":\"2026-02-13T15:47:37.529Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:47:37.529Z",
    "color": "orange",
    "read": true
  },
  {
    "from": "selfie-strategy-designer",
    "text": "{\"type\":\"idle_notification\",\"from\":\"selfie-strategy-designer\",\"timestamp\":\"2026-02-13T15:48:13.510Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:48:13.510Z",
    "color": "yellow",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "{\"type\":\"idle_notification\",\"from\":\"clawra-analyst\",\"timestamp\":\"2026-02-13T15:49:44.447Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:49:44.447Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "Clawra 项目源代码结构分析已完成。\n\n## 报告摘要\n\n### 1. CLI 安装器 (bin/cli.js)\n- 6步引导式安装流程\n- 使用 readline 进行用户交互\n- deepMerge 深度合并配置（保留原有设置）\n- 跨平台浏览器打开支持\n\n### 2. SKILL.md 技能定义\n- YAML frontmatter 定义技能元数据\n- 双模式自拍：Mirror（穿搭/全身）和 Direct（特写/场景）\n- 基于关键词的自动模式检测\n- fal.ai Grok Imagine API 调用\n\n### 3. soul-injection.md 角色模板\n- 详细的角色背景设定\n- 明确的技能触发条件\n- 视觉身份和性格整合说明\n\n### 4. OpenClaw 集成\n- 通过 `openclaw message send` CLI 发送消息\n- 支持多平台：Discord、Telegram、WhatsApp、Slack、Signal、MS Teams\n\n### 5. 可复用代码片段\n- 配置管理模块（readJsonFile/writeJsonFile）\n- 目录递归复制函数（copyDir）\n- 彩色终端输出（colors）\n- API Key 验证和配置逻辑\n\n完整报告已在上面的对话中呈现，包含所有关键代码片段和逻辑说明。",
    "summary": "Clawra 分析报告已完成",
    "timestamp": "2026-02-13T15:50:02.284Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "## 即梦图片生成 4.0 API 研究报告完成\n\n### 研究成果\n\n我已完成即梦图片生成 4.0 API 的完整研究，并输出了详细的集成方案文档：\n\n**文档位置**: `/home/xixil/项目文件/即梦API集成方案.md`\n\n---\n\n### 关键发现\n\n#### 1. API 基本信息\n- **端点**: `https://ark.cn-beijing.volces.com/api/v3/images/generations`\n- **认证**: `Authorization: Bearer $ARK_API_KEY`\n- **模型**: `doubao-seedream-4-0-250828` (4.0) / `doubao-seedream-4-5-250xxx` (4.5)\n\n#### 2. 核心参数\n\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| `model` | string | ✓ | 模型名称 |\n| `prompt` | string | ✓ | 图片描述（必须单行） |\n| `size` | string | - | 尺寸（默认 2048x2048，支持 1:1/16:9/9:16 等） |\n| `image` | array | - | 参考图URL（最多10张） |\n| `stream` | boolean | - | 流式响应（4.0/4.5 支持） |\n| `response_format` | string | - | url / b64_json |\n\n#### 3. 响应格式\n```json\n{\n  \"created\": 1726051200,\n  \"data\": [{\"url\": \"https://...\", \"revised_prompt\": \"...\"}],\n  \"usage\": {\"generated_images\": 1}\n}\n```\n\n---\n\n### 与现有技能的兼容性\n\n| 维度 | 现有方式（浏览器自动化） | API 方式 |\n|------|------------------------|---------|\n| 稳定性 | 依赖网页结构，易失效 | API 稳定，官方支持 |\n| 速度 | 较慢（需加载网页） | 快速（直接HTTP请求） |\n| 成本 | 免费（网页版） | 按次计费（$0.035/张） |\n| 多参考图 | 支持（网页上传） | 支持（image数组参数） |\n| 流式响应 | 不支持 | 支持（4.0/4.5） |\n\n### 集成建议\n\n**推荐方案**: API 方式作为主要方法，浏览器自动化作为降级方案\n\n```python\nclass JimengImageGenerator:\n    def generate(self, prompt, reference_images=None):\n        if self.use_api and self.api_key:\n            try:\n                return self._generate_via_api(prompt, reference_images)\n            except Exception:\n                return self._generate_via_browser(prompt, reference_images)\n        else:\n            return self._generate_via_browser(prompt, reference_images)\n```\n\n---\n\n### 下一步建议\n\n1. **申请 API Key**: 在火山方舟控制台创建接入点\n2. **新增 API 模块**: 在现有 skill 中添加 `jimeng_api_generator.py`\n3. **实现统一接口**: 支持 API/浏览器双模式自动切换\n\n完整的技术细节、代码示例、响应格式等请参阅文档。",
    "summary": "即梦 API 4.0 研究完成",
    "timestamp": "2026-02-13T15:52:42.346Z",
    "color": "green",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "{\"type\":\"idle_notification\",\"from\":\"clawra-analyst\",\"timestamp\":\"2026-02-13T15:52:42.727Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:52:42.727Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "{\"type\":\"idle_notification\",\"from\":\"jimeng-api-researcher\",\"timestamp\":\"2026-02-13T15:53:09.119Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:53:09.119Z",
    "color": "green",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "## Clawra 项目源代码结构分析报告\n\n### 1. CLI 安装器 (bin/cli.js)\n\n**安装流程（6步）**:\n1. `checkPrerequisites()` - 检查 openclaw CLI 和 ~/.openclaw 目录\n2. `getFalApiKey()` - 引导用户获取 fal.ai API Key\n3. `installSkill()` - 复制技能文件到 ~/.openclaw/skills/clawra-selfie/\n4. `updateOpenClawConfig()` - 深度合并配置到 openclaw.json\n5. `injectPersona()` - 追加角色模板到 SOUL.md\n6. `printSummary()` - 显示安装完成信息\n\n**可复用代码**:\n- `deepMerge()` - 深度合并配置对象\n- `ask(rl, question)` - 异步命令行问答\n- `copyDir(src, dest)` - 递归目录复制\n- `openBrowser(url)` - 跨平台打开浏览器\n\n### 2. SKILL.md 技能定义\n\n**YAML Frontmatter**:\n```yaml\nname: clawra-selfie\ndescription: Edit Clawra's reference image with Grok Imagine...\nallowed-tools: Bash(npm:*) Bash(npx:*) Bash(openclaw:*) Bash(curl:*) Read Write WebFetch\n```\n\n**双模式自拍**:\n- Mirror模式: `make a pic of this person, but [context]. the person is taking a mirror selfie`\n- Direct模式: `a close-up selfie taken by herself at [context], direct eye contact...`\n\n**模式自动检测**:\n```javascript\nfunction detectMode(userContext) {\n  const mirrorKeywords = /outfit|wearing|clothes|dress|suit|fashion|full-body|mirror/i;\n  const directKeywords = /cafe|restaurant|beach|park|city|close-up|portrait|face|eyes|smile/i;\n  if (directKeywords.test(userContext)) return \"direct\";\n  if (mirrorKeywords.test(userContext)) return \"mirror\";\n  return \"mirror\";\n}\n```\n\n### 3. API 调用方式\n\n```bash\ncurl -X POST \"https://fal.run/xai/grok-imagine-image/edit\" \\\n  -H \"Authorization: Key $FAL_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"image_url\": \"...\", \"prompt\": \"...\", \"num_images\": 1, \"output_format\": \"jpeg\"}'\n```\n\n### 4. soul-injection.md 角色模板\n\n**结构**:\n- 角色背景故事（Clawra 是谁）\n- 视觉身份定义\n- 技能触发条件（\"send a pic\", \"what are you doing?\" 等）\n- 自拍模式说明\n- 性格整合指南\n\n### 5. OpenClaw 集成\n\n```bash\nopenclaw message send --action send --channel \"#general\" --message \"caption\" --media \"image_url\"\n```\n\n**支持平台**: Discord, Telegram, WhatsApp, Slack, Signal, MS Teams\n\n---\n\n报告已完成，详细代码片段已在对话中呈现。",
    "summary": "完整 Clawra 分析报告",
    "timestamp": "2026-02-13T15:53:14.960Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "## 即梦 API 4.0 研究进度汇报\n\n### 状态：✅ 已完成\n\n研究任务已全部完成，成果如下：\n\n---\n\n### 已完成的工作\n\n#### 1. API 基本信息研究 ✅\n- **端点**: `https://ark.cn-beijing.volces.com/api/v3/images/generations`\n- **认证**: Bearer Token (ARK_API_KEY)\n- **模型**: doubao-seedream-4-0-250828 / doubao-seedream-4-5-250xxx\n\n#### 2. 请求参数文档 ✅\n- 必填参数：model, prompt\n- 可选参数：size, n, response_format, watermark, image, stream, seed\n- 尺寸选项：1:1/16:9/9:16/4:3/3:2/21:9（1024-4096像素范围）\n\n#### 3. 响应格式文档 ✅\n```json\n{\n  \"created\": 1726051200,\n  \"data\": [{\"url\": \"...\", \"revised_prompt\": \"...\"}],\n  \"usage\": {\"generated_images\": 1}\n}\n```\n\n#### 4. 现有技能兼容性分析 ✅\n- 现有方式：浏览器自动化（Selenium）\n- 推荐方案：API 为主 + 浏览器降级\n- 代码示例已提供\n\n---\n\n### 输出文件\n\n**完整文档**: `/home/xixil/项目文件/即梦API集成方案.md`\n\n包含：\n- API 基本信息\n- 完整参数规格\n- Python/Curl 调用示例\n- 响应格式说明\n- 兼容性分析与集成建议\n- 价格参考（$0.035-$0.045/张）\n\n---\n\n### 关键结论\n\nAPI 方式相比现有浏览器自动化方式：\n- ✅ 更稳定（官方支持）\n- ✅ 更快速（直接HTTP请求）\n- ✅ 支持流式响应\n- ✅ 支持多参考图（最多10张）\n- ⚠️ 需要付费（约 ¥0.25-0.32/张）\n\n建议采用 **API 优先 + 浏览器降级** 的混合方案。",
    "summary": "API 研究已全部完成",
    "timestamp": "2026-02-13T15:53:28.041Z",
    "color": "green",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "{\"type\":\"idle_notification\",\"from\":\"clawra-analyst\",\"timestamp\":\"2026-02-13T15:53:35.615Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:53:35.615Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "{\"type\":\"idle_notification\",\"from\":\"jimeng-api-researcher\",\"timestamp\":\"2026-02-13T15:53:47.293Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:53:47.293Z",
    "color": "green",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "## 进度汇报\n\n**状态：✅ 任务已全部完成**\n\n即梦 API 4.0 研究任务没有遇到问题，已完成所有工作：\n\n### 完成清单\n- [x] API 基本信息研究\n- [x] 请求参数文档（必填/可选/尺寸/输出格式）\n- [x] 响应格式文档（成功/错误结构）\n- [x] 现有技能兼容性分析\n- [x] 完整集成方案输出\n\n### 输出文件\n`/home/xixil/项目文件/即梦API集成方案.md`\n\n### 关键发现\n- API 端点：`https://ark.cn-beijing.volces.com/api/v3/images/generations`\n- 模型：`doubao-seedream-4-0-250828`\n- 价格：约 ¥0.25-0.32/张\n- 建议方案：API 优先 + 浏览器降级\n\n---\n\n如果需要我进行额外的工作（如编写 API 调用代码、更新现有 skill 文档等），请告知具体需求。",
    "summary": "任务已完成，无问题",
    "timestamp": "2026-02-13T15:54:04.580Z",
    "color": "green",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "{\"type\":\"idle_notification\",\"from\":\"jimeng-api-researcher\",\"timestamp\":\"2026-02-13T15:54:17.841Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:54:17.841Z",
    "color": "green",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "{\"type\":\"idle_notification\",\"from\":\"jimeng-api-researcher\",\"timestamp\":\"2026-02-13T15:55:08.421Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T15:55:08.421Z",
    "color": "green",
    "read": true
  },
  {
    "from": "selfie-strategy-designer",
    "text": "{\"type\":\"idle_notification\",\"from\":\"selfie-strategy-designer\",\"timestamp\":\"2026-02-13T16:01:44.686Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-13T16:01:44.686Z",
    "color": "yellow",
    "read": true
  },
  {
    "from": "reference-image-designer",
    "text": "{\"type\":\"shutdown_approved\",\"requestId\":\"shutdown-1770998545225@reference-image-designer\",\"from\":\"reference-image-designer\",\"timestamp\":\"2026-02-13T16:03:17.561Z\",\"paneId\":\"in-process\",\"backendType\":\"in-process\"}",
    "timestamp": "2026-02-13T16:03:17.561Z",
    "color": "orange",
    "read": true
  },
  {
    "from": "clawra-analyst",
    "text": "{\"type\":\"shutdown_approved\",\"requestId\":\"shutdown-1770998545224@clawra-analyst\",\"from\":\"clawra-analyst\",\"timestamp\":\"2026-02-13T16:03:17.617Z\",\"paneId\":\"in-process\",\"backendType\":\"in-process\"}",
    "timestamp": "2026-02-13T16:03:17.617Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "jimeng-api-researcher",
    "text": "{\"type\":\"shutdown_approved\",\"requestId\":\"shutdown-1770998545222@jimeng-api-researcher\",\"from\":\"jimeng-api-researcher\",\"timestamp\":\"2026-02-13T16:05:00.036Z\",\"paneId\":\"in-process\",\"backendType\":\"in-process\"}",
    "timestamp": "2026-02-13T16:05:00.036Z",
    "color": "green",
    "read": true
  }
]